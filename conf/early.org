#+TITLE: My Early Init Emacs Configuration
#+AUTHOR: Samuel Nilsson
#+EMAIL: samuel@samuelnilsson.net
#+OPTIONS: num:nil

* Font/Theme

Fonts and themes needs to be evaluated in early-init to work for first frame in daemon mode.
See [[https://www.gnu.org/software/emacs/manual/html_node/elisp/Creating-Frames.html#index-server_002dafter_002dmake_002dframe_002dhook][docs]].

** Font

*** Set the font

#+begin_src emacs-lisp
(defun set-buffer-variable-pitch ()
  (interactive)
  (variable-pitch-mode t)
  (set-face-attribute 'org-table nil :inherit 'fixed-pitch)
  (set-face-attribute 'org-link nil :inherit 'fixed-pitch)
  (set-face-attribute 'org-code nil :inherit 'fixed-pitch)
  (set-face-attribute 'org-block nil :inherit 'fixed-pitch)
  (set-face-attribute 'org-date nil :inherit 'fixed-pitch)
  (set-face-attribute 'org-special-keyword nil :inherit 'fixed-pitch))

(add-hook 'org-mode-hook 'set-buffer-variable-pitch)

(defun set-font ()
  (set-face-attribute 'default nil :font "Iosevka Nerd Font" :height @fontSize@)
  (set-face-attribute 'fixed-pitch nil :font "Iosevka Nerd Font" :height @fontSize@)
  (set-face-attribute 'variable-pitch nil :font "Iosevka Aile" :height @fontSize@))
#+end_src

*** Ligatures

Ligatures are enabled using the ligature.el package, since support is not built into emacs.

#+begin_src emacs-lisp
(defun set-ligatures ()
  (use-package ligature
    :config
      (ligature-set-ligatures 'prog-mode '("<---" "<--"  "<<-" "<-" "->" "-->" "--->" "<->" "<-->" "<--->" "<---->" "<!--"
					 "<==" "<===" "<=" "=>" "=>>" "==>" "===>" ">=" "<=>" "<==>" "<===>" "<====>" "<!---"
					 "<~~" "<~" "~>" "~~>" "::" ":::" "==" "!=" "===" "!=="
					 ":=" ":-" ":+" "<*" "<*>" "*>" "<|" "<|>" "|>" "+:" "-:" "=:" "<******>" "++" "+++"))
      (global-ligature-mode t)))
#+end_src

** Theme

Set the catppuccin macchiato theme to not burn my eyes.

#+begin_src emacs-lisp
(defun set-theme ()
  (load-theme 'catppuccin :no-confirm)
  (setq catppuccin-flavor 'macchiato)
  (catppuccin-reload))
#+end_src

** Opacity

#+begin_src emacs-lisp
(defun set-opacity (frame)
  (set-frame-parameter frame 'alpha 98))
#+end_src

** Eval fonts and themes on new frame

Only eval fonts and theme related configuration when creating a frame.
Otherwise it will not work in daemon mode.

#+begin_src emacs-lisp
  (defun new-frame-setup (frame)
    (when (display-graphic-p frame)
      (set-font)
      (set-ligatures)
      (set-theme)
      (set-opacity frame)))

  (defun new-frame-setup-no-daemon (frame)
    (new-frame-setup frame))

  (defun new-frame-setup-daemon ()
    (new-frame-setup (selected-frame)))

  (if (daemonp)
    (add-hook 'server-after-make-frame-hook 'new-frame-setup-daemon)
    (add-hook 'after-make-frame-functions 'new-frame-setup-no-daemon))
#+end_src
